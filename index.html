<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Spelling Billionaire</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Comic+Neue:wght@700&display=swap');
body{
  margin:0;
  font-family:'Comic Neue',cursive;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  background:#d9cfff;
}
#container{display:flex;width:80%;max-width:1000px;position:relative}
#stageLights{
  position:absolute;top:0;left:50%;
  width:120%;height:120%;
  background:radial-gradient(circle,var(--lightColor,rgba(255,255,200,0.3)) 0%,transparent 70%);
  border-radius:50%;transform:translateX(-50%);
  pointer-events:none;opacity:0;
  animation:lightPulse 2s infinite alternate;z-index:0;
}
@keyframes lightPulse{0%{opacity:0.1}50%{opacity:0.4}100%{opacity:0.1}}
#playfield{
  background:#b499e6;
  flex:2;padding:40px;border-radius:25px;
  text-align:center;box-shadow:0 8px 25px rgba(0,0,0,.3);
  position:relative;transition:box-shadow .3s;
  z-index:1;display:flex;flex-direction:column;align-items:center;
}
#playfield.levelUp{box-shadow:0 0 20px 8px #fffacd,0 8px 25px rgba(0,0,0,.3);animation:flash .6s ease-in-out 2}
@keyframes flash{0%{box-shadow:0 0 20px 8px #fffacd,0 8px 25px rgba(0,0,0,.3)}50%{box-shadow:0 0 40px 15px #fffacd,0 8px 25px rgba(0,0,0,.3)}100%{box-shadow:0 0 20px 8px #fffacd,0 8px 25px rgba(0,0,0,.3)}}
#levelDisplay{font-size:28px;margin-bottom:15px;font-weight:bold}
#answer{
  font-size:28px;padding:10px;margin:10px 10px 5px 0;
  width:60%;border-radius:10px;text-align:center;
}
#checkBtn{
  font-size:24px;padding:10px 16px;
  display:inline-block;vertical-align:middle;
}
#inputRow{
  display:flex;justify-content:center;align-items:center;
}
#hearWordBtn{
  font-size:28px;
  padding:10px 20px;
  margin-top:15px; /* moved down from keyboard */
  animation:pulseBuzzer 1s infinite alternate;
}
@keyframes pulseBuzzer{
  0%{transform:scale(1);box-shadow:0 0 5px #fffacd}
  50%{transform:scale(1.05);box-shadow:0 0 15px #fffacd}
  100%{transform:scale(1);box-shadow:0 0 5px #fffacd}
}
#bottomControls{
  display:flex;justify-content:center;gap:10px;
  margin-top:20px;transform:scale(0.8);
}
select{
  font-size:16px;padding:4px 6px;border-radius:8px;
}
button#restartBtn{font-size:20px;padding:6px 12px;}
#sidebar{
  flex:1;margin-left:20px;background:#c9b3ff;
  border-radius:20px;padding:20px;max-height:80vh;
  overflow-y:auto;position:relative;z-index:1;
}
#sidebar h3{text-align:center;margin-top:0}
.levelItem{padding:8px;margin:5px 0;border-radius:10px;background:#e6d4ff;transition:transform .3s,box-shadow .3s;text-align:center;font-weight:bold;position:relative;overflow:hidden}
.currentLevel{background:#ffe066;animation:pulse 1s infinite alternate}
@keyframes pulse{0%{transform:scale(1);box-shadow:0 0 0 #fff}50%{transform:scale(1.05);box-shadow:0 0 15px #fffacd}100%{transform:scale(1);box-shadow:0 0 0 #fff}}
.levelItem.completedLevel{background:#90ee90;animation:glow .6s ease-in-out}
@keyframes glow{0%{box-shadow:0 0 0 #00ff00}50%{box-shadow:0 0 15px #00ff00}100%{box-shadow:0 0 0 #00ff00}}
.correct{color:#00ff00;font-weight:bold}
.wrong{color:#ff4d4d;font-weight:bold;animation:shake .5s}
@keyframes shake{0%{transform:translateX(0)}25%{transform:translateX(-5px)}50%{transform:translateX(5px)}75%{transform:translateX(-5px)}100%{transform:translateX(0)}}
.confetti{position:absolute;width:10px;height:10px;top:0;animation:fall 2s linear forwards}
@keyframes fall{to{transform:translateY(400px) rotate(360deg);opacity:0}}
#virtualKeyboard{display:flex;flex-wrap:wrap;justify-content:center;margin-top:10px;gap:5px}
.keyBtn{font-size:20px;padding:10px 12px;border-radius:8px;cursor:pointer;user-select:none;background:#e6d4ff;transition:0.2s}
.keyBtn:hover{background:#d4b3ff}
#keyboardControls{display:flex;justify-content:center;gap:10px;margin-top:5px}
</style>
</head>
<body>
<div id="container">
  <div id="stageLights"></div>

  <div id="playfield">
    <h2>Spelling Billionaire</h2>

    <div id="inputRow">
      <input type="text" id="answer" placeholder="Type the word here" autocomplete="off" />
      <button id="checkBtn" onclick="checkWord()">Check</button>
    </div>

    <div id="virtualKeyboard"></div>
    <div id="keyboardControls">
      <button onclick="addLetter('Backspace')">Backspace</button>
      <button onclick="addLetter('Clear')">Clear</button>
    </div>

    <button id="hearWordBtn" onclick="speakWord()">Hear Word</button>
    <p id="feedback"></p>

    <div id="bottomControls">
      <select id="wordListSelect"><option value="">-- Select Word List --</option></select>
      <select id="voiceSelect"><option value="">Loading voices...</option></select>
      <button id="restartBtn" onclick="restartGame()">Restart</button>
    </div>

    <div id="levelDisplay">Level: 0</div>
  </div>

  <div id="sidebar">
    <h3>Levels</h3>
    <div id="levelList"></div>
  </div>
</div>

<audio id="correctSound" src="correct.mp3"></audio>
<audio id="wrongSound" src="wrong.mp3"></audio>
<audio id="mainSound" src="main.mp3"></audio>
<audio id="fangSound" src="fang.mp3"></audio>

<script>
document.addEventListener("DOMContentLoaded", () => {

  const presetWordLists = {
    "Lesson 51-52": ["king","fang","lung","long","sink","junk","honk","bank","would","could"]
  };

  let words = [];
  let currentWord = "";
  let level = 0;
  let selectedVoice = null;
  let availableVoices = [];

  const wordListSelect = document.getElementById('wordListSelect');
  const voiceSelect = document.getElementById('voiceSelect');

  for (let listName in presetWordLists) {
    const option = document.createElement('option');
    option.value = listName;
    option.textContent = listName;
    wordListSelect.appendChild(option);
  }

  function populateVoiceList() {
    const voices = window.speechSynthesis.getVoices();
    availableVoices = voices.filter(v =>
      (v.lang && (v.lang.startsWith("en-CA") || v.lang.startsWith("en-US"))) &&
      (v.name.includes("Clara") || v.name.includes("Liam"))
    );

    voiceSelect.innerHTML = "";
    if (availableVoices.length === 0) {
      const opt = document.createElement('option'); opt.value = ""; opt.textContent = "No Clara/Liam found"; voiceSelect.appendChild(opt);
      selectedVoice = null;
      return;
    }

    availableVoices.forEach(v => {
      const option = document.createElement('option');
      option.value = v.name;
      option.textContent = v.name.includes("Clara") ? "Clara" : (v.name.includes("Liam") ? "Liam" : v.name);
      voiceSelect.appendChild(option);
    });
    selectedVoice = availableVoices[0];
  }
  window.speechSynthesis.onvoiceschanged = populateVoiceList;
  populateVoiceList();

  voiceSelect.addEventListener("change", () => {
    selectedVoice = availableVoices.find(v => v.name === voiceSelect.value);
  });

  wordListSelect.addEventListener("change", () => {
    const listName = wordListSelect.value;
    if (!listName) return;
    words = presetWordLists[listName].slice();
    level = 0;
    document.getElementById('levelDisplay').textContent = "Level: " + level;
    document.getElementById('feedback').textContent = "";
    buildLevelSidebar();
  });

  function buildLevelSidebar(){
    const levelList = document.getElementById('levelList');
    levelList.innerHTML = "";
    for (let i = words.length - 1; i >= 0; i--) {
      const div = document.createElement('div');
      div.textContent = `Level ${i+1}`;
      div.className = "levelItem";
      if (i === level) div.classList.add("currentLevel");
      levelList.appendChild(div);
    }
  }

  function updateSidebar(){
    const items = document.getElementsByClassName('levelItem');
    for (let i=0;i<items.length;i++){
      items[i].classList.remove("currentLevel","completedLevel");
      const wordIndex = words.length - 1 - i;
      if (wordIndex < level) {
        items[i].classList.add("completedLevel");
        items[i].textContent = `Level ${wordIndex+1}: ${words[wordIndex]}`;
      } else if (wordIndex === level) {
        items[i].classList.add("currentLevel");
        items[i].textContent = `Level ${wordIndex+1}`;
      } else {
        items[i].textContent = `Level ${wordIndex+1}`;
      }
    }
  }

  function getCurrentWord(){ return words[level] || ""; }

  function speakWordText(word){
    const msg = new SpeechSynthesisUtterance(word);
    if (selectedVoice) msg.voice = selectedVoice;
    window.speechSynthesis.speak(msg);
  }

  window.speakWord = function(){
    if (!words.length) { alert("Please select a word list!"); return; }
    currentWord = getCurrentWord();
    if(currentWord === "fang"){
      document.getElementById('fangSound').play();
    } else {
      speakWordText(currentWord);
    }
    document.getElementById('answer').value = "";
    document.getElementById('feedback').textContent = "";
  };

  window.checkWord = function(){
    if (!words.length) { alert("Please select a word list!"); return; }
    const answerInput = document.getElementById('answer');
    const answer = answerInput.value.trim().toLowerCase();
    const playfield = document.getElementById('playfield');

    if (answer === currentWord) {
      level++;
      updateSidebar();
      document.getElementById('levelDisplay').textContent = "Level: " + level;
      document.getElementById('feedback').textContent = "üéâ Correct!";
      document.getElementById('feedback').className = "correct";
      document.getElementById('correctSound').play();
      showConfetti();
      playfield.classList.add("levelUp");
      setTimeout(()=>playfield.classList.remove("levelUp"),1200);

      if (level >= words.length) {
        setTimeout(()=> document.getElementById('mainSound').play(), 3000);
      }

    } else {
      document.getElementById('feedback').textContent = "‚ùå Try again!";
      document.getElementById('feedback').className = "wrong";
      document.getElementById('wrongSound').play();
    }
  };

  function showConfetti(){
    const playfield = document.getElementById('playfield');
    for (let i=0;i<30;i++){
      const confetti = document.createElement('div');
      confetti.className = 'confetti';
      confetti.style.backgroundColor = `hsl(${Math.random()*360},100%,50%)`;
      confetti.style.left = Math.random()*(playfield.offsetWidth-10) + 'px';
      confetti.style.animationDuration = (1.5+Math.random()) + 's';
      playfield.appendChild(confetti);
      setTimeout(()=> confetti.remove(),2000);
    }
  }

  // Virtual Keyboard
  const keyboardContainer = document.getElementById('virtualKeyboard');
  const letters = "abcdefghijklmnopqrstuvwxyz".split('');
  letters.forEach(l=>{
    const btn = document.createElement('button');
    btn.textContent = l;
    btn.className="keyBtn";
    btn.onclick=()=>addLetter(l);
    keyboardContainer.appendChild(btn);
  });

  window.addLetter = function(l){
    const input = document.getElementById('answer');
    if(l==="Backspace"){ input.value=input.value.slice(0,-1);}
    else if(l==="Clear"){ input.value="";}
    else{ input.value+=l;}
  }

  window.restartGame = function(){
    if (!words.length) { alert("Please select a word list!"); return; }
    const mainAudio = document.getElementById('mainSound');
    mainAudio.pause();
    mainAudio.currentTime = 0;

    level = 0;
    document.getElementById('levelDisplay').textContent = "Level: " + level;
    document.getElementById('feedback').textContent = "";
    document.getElementById('answer').value = "";
    buildLevelSidebar();
    updateSidebar();
  };

});
</script>
</body>
</html>
